import{b as C,c as j}from"./chunk-2ZLNSD6U.js";import{$a as z,A as h,Aa as m,Ab as q,Bb as J,D as O,Ja as v,Q as a,W as d,X as _,Xa as x,Y as y,ca as s,da as l,ia as c,ja as r,ka as n,la as u,mb as S,nb as H,ob as g,pb as A,ra as N,s as R,sb as V,ta as f,tb as E,ub as p,vb as L,wb as I,xb as F,yb as w,zb as T}from"./chunk-YKZVNGVC.js";var K=(e,o)=>{let i=O(C),t=O(g);if(!i.userValue)return!0;let k=e.queryParamMap.get("returnUrl")||"/";return t.navigate([k]),!1};var M=class e{constructor(o,i,t){this.route=o;this.router=i;this.accountService=t;console.log("LayoutComponent constructor")}ngOnInit(){console.log("LayoutComponent ngOnInit"),console.log(this.route)}static \u0275fac=function(i){return new(i||e)(d(S),d(g),d(C))};static \u0275cmp=_({type:e,selectors:[["ng-component"]],standalone:!1,decls:2,vars:0,consts:[[1,"container","col-md-6","offset-md-3","mt-5"]],template:function(i,t){i&1&&(r(0,"div",0),u(1,"router-outlet"),n())},dependencies:[H],encapsulation:2})};var Y=e=>({"is-invalid":e});function ie(e,o){e&1&&(r(0,"div"),m(1,"Username is required"),n())}function ne(e,o){if(e&1&&(r(0,"div",7),s(1,ie,2,0,"div"),n()),e&2){let i=f();a(),l(i.f.username.errors.required?1:-1)}}function oe(e,o){e&1&&(r(0,"div"),m(1,"Password is required"),n())}function re(e,o){if(e&1&&(r(0,"div",7),s(1,oe,2,0,"div"),n()),e&2){let i=f();a(),l(i.f.password.errors.required?1:-1)}}function ae(e,o){e&1&&u(0,"span",10)}var B=class e{constructor(o,i,t,b,k){this.formBuilder=o;this.route=i;this.router=t;this.accountService=b;this.alertService=k}form;loading=!1;submitted=!1;ngOnInit(){this.form=this.formBuilder.group({username:["user",p.required],password:["password",p.required]})}get f(){return this.form.controls}onSubmit(){this.submitted=!0,this.alertService.clear(),!this.form.invalid&&(this.loading=!0,this.accountService.login(this.f.username.value,this.f.password.value).pipe(R()).subscribe({next:()=>{let o=this.route.snapshot.queryParamMap.get("returnUrl")||sessionStorage.getItem("returnUrl")||"/";sessionStorage.removeItem("returnUrl"),this.router.navigateByUrl(o)},error:o=>{this.alertService.error(o?.error?.message||"Login failed"),this.loading=!1}}))}static \u0275fac=function(i){return new(i||e)(d(q),d(S),d(g),d(C),d(j))};static \u0275cmp=_({type:e,selectors:[["ng-component"]],standalone:!1,decls:21,vars:11,consts:[[1,"card"],[1,"card-header"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","username",1,"form-control",3,"ngClass"],[1,"invalid-feedback"],["type","password","formControlName","password",1,"form-control",3,"ngClass"],[1,"btn","btn-primary",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-1"],["routerLink","../register",1,"btn","btn-link"]],template:function(i,t){i&1&&(r(0,"div",0)(1,"h4",1),m(2,"Login"),n(),r(3,"div",2)(4,"form",3),N("ngSubmit",function(){return t.onSubmit()}),r(5,"div",4)(6,"label",5),m(7,"Username"),n(),u(8,"input",6),s(9,ne,2,1,"div",7),n(),r(10,"div",4)(11,"label",5),m(12,"Password"),n(),u(13,"input",8),s(14,re,2,1,"div",7),n(),r(15,"div")(16,"button",9),s(17,ae,1,0,"span",10),m(18," Login "),n(),r(19,"a",11),m(20,"Register"),n()()()()()),i&2&&(a(4),c("formGroup",t.form),a(4),c("ngClass",v(7,Y,t.submitted&&t.f.username.errors)),a(),l(t.submitted&&t.f.username.errors?9:-1),a(4),c("ngClass",v(9,Y,t.submitted&&t.f.password.errors)),a(),l(t.submitted&&t.f.password.errors?14:-1),a(2),c("disabled",t.loading),a(),l(t.loading?17:-1))},dependencies:[x,F,E,L,I,w,T,A],encapsulation:2})};var G=e=>({"is-invalid":e});function me(e,o){e&1&&(r(0,"div"),m(1,"First Name is required"),n())}function se(e,o){if(e&1&&(r(0,"div",7),s(1,me,2,0,"div"),n()),e&2){let i=f();a(),l(i.f.firstName.errors.required?1:-1)}}function le(e,o){e&1&&(r(0,"div"),m(1,"Last Name is required"),n())}function de(e,o){if(e&1&&(r(0,"div",7),s(1,le,2,0,"div"),n()),e&2){let i=f();a(),l(i.f.lastName.errors.required?1:-1)}}function ce(e,o){e&1&&(r(0,"div"),m(1,"Username is required"),n())}function ue(e,o){if(e&1&&(r(0,"div",7),s(1,ce,2,0,"div"),n()),e&2){let i=f();a(),l(i.f.username.errors.required?1:-1)}}function pe(e,o){e&1&&(r(0,"div"),m(1,"Password is required"),n())}function fe(e,o){e&1&&(r(0,"div"),m(1,"Password must be at least 6 characters"),n())}function ve(e,o){if(e&1&&(r(0,"div",7),s(1,pe,2,0,"div"),s(2,fe,2,0,"div"),n()),e&2){let i=f();a(),l(i.f.password.errors.required?1:-1),a(),l(i.f.password.errors.minlength?2:-1)}}function ge(e,o){e&1&&u(0,"span",12)}var U=class e{constructor(o,i,t,b,k){this.formBuilder=o;this.route=i;this.router=t;this.accountService=b;this.alertService=k}form;loading=!1;submitted=!1;ngOnInit(){this.form=this.formBuilder.group({firstName:["",p.required],lastName:["",p.required],username:["",p.required],password:["",[p.required,p.minLength(6)]]})}get f(){return this.form.controls}onSubmit(){this.submitted=!0,this.alertService.clear(),!this.form.invalid&&(this.loading=!0,this.accountService.register(this.form.value).pipe(R()).subscribe({next:()=>{this.alertService.success("Registration successful",{keepAfterRouteChange:!0}),this.router.navigate(["../login"],{relativeTo:this.route})},error:o=>{this.alertService.error(o?.error?.message||"Registration failed"),this.loading=!1}}))}static \u0275fac=function(i){return new(i||e)(d(q),d(S),d(g),d(C),d(j))};static \u0275cmp=_({type:e,selectors:[["ng-component"]],standalone:!1,decls:31,vars:19,consts:[[1,"card"],[1,"card-header"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","firstName",1,"form-control",3,"ngClass"],[1,"invalid-feedback"],["type","text","formControlName","lastName",1,"form-control",3,"ngClass"],["type","text","formControlName","username",1,"form-control",3,"ngClass"],["type","password","formControlName","password",1,"form-control",3,"ngClass"],[1,"btn","btn-primary",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-1"],["routerLink","../login",1,"btn","btn-link"]],template:function(i,t){i&1&&(r(0,"div",0)(1,"h4",1),m(2,"Register"),n(),r(3,"div",2)(4,"form",3),N("ngSubmit",function(){return t.onSubmit()}),r(5,"div",4)(6,"label",5),m(7,"First Name"),n(),u(8,"input",6),s(9,se,2,1,"div",7),n(),r(10,"div",4)(11,"label",5),m(12,"Last Name"),n(),u(13,"input",8),s(14,de,2,1,"div",7),n(),r(15,"div",4)(16,"label",5),m(17,"Username"),n(),u(18,"input",9),s(19,ue,2,1,"div",7),n(),r(20,"div",4)(21,"label",5),m(22,"Password"),n(),u(23,"input",10),s(24,ve,3,2,"div",7),n(),r(25,"div")(26,"button",11),s(27,ge,1,0,"span",12),m(28," Register "),n(),r(29,"a",13),m(30,"Cancel"),n()()()()()),i&2&&(a(4),c("formGroup",t.form),a(4),c("ngClass",v(11,G,t.submitted&&t.f.firstName.errors)),a(),l(t.submitted&&t.f.firstName.errors?9:-1),a(4),c("ngClass",v(13,G,t.submitted&&t.f.lastName.errors)),a(),l(t.submitted&&t.f.lastName.errors?14:-1),a(4),c("ngClass",v(15,G,t.submitted&&t.f.username.errors)),a(),l(t.submitted&&t.f.username.errors?19:-1),a(4),c("ngClass",v(17,G,t.submitted&&t.f.password.errors)),a(),l(t.submitted&&t.f.password.errors?24:-1),a(2),c("disabled",t.loading),a(),l(t.loading?27:-1))},dependencies:[x,F,E,L,I,w,T,A],encapsulation:2})};var Ce=[{path:"",component:M,canActivate:[K],children:[{path:"login",title:"Login",component:B},{path:"register",title:"Register",component:U}]}],P=class e{static \u0275fac=function(i){return new(i||e)};static \u0275mod=y({type:e});static \u0275inj=h({imports:[V.forChild(Ce),V]})};var Z=class e{static \u0275fac=function(i){return new(i||e)};static \u0275mod=y({type:e});static \u0275inj=h({imports:[z,J,P]})};export{Z as AccountModule};
